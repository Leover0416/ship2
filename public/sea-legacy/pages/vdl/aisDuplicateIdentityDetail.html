<html lang="en" xmlns="">
<head>
    <script src="../../pages/vdl/vdlMap.js"></script>
</head>
<style>
    .layui-layer-title {
        display: none;
    }

    .layui-layer-setwin .layui-layer-close1 {
        display: none;
    }
</style>
<div class="layui-card" style="width:1695px; height: 1000px;background-color: #9F9F9F;">
    <div class="layui-card-header" style="background-color: white ;margin-top:-10px;">
        <h2 class="header-title" style="font-weight: bold; font-size: 30px ;margin-top: -20px;"><font color="#9F9F9F">身份重复船台辨识结果</font>
        </h2>
    </div>

    <div style=" margin-top: 5px ;margin-left: 10px;">
        <div style="width: 100%; background-color: white;">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 1px">船舶基本信息：</p>
        </div>

        <div class="layui-card-body" style="margin-top: 2px;background-color: white;padding: 2px ">
            <table class=layui-table" lay-skin="line" style="font-size: 14px;">
                <tr>
                    <td style="display: none">ID：</td>
                    <td><input style='border: 0px; display: none' id='duplicateIdentityID' readonly/></td>
                    <td>MMSI：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityShipMmsi' readonly/></td>
                    <td>当前位置：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityCurrentLocation' readonly/></td>
                </tr>
            </table>
        </div>

        <div style="width: 100% ; height: 30px;background-color: white;margin-top: 1px;">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 1px">船舶异常信息：</p>
        </div>

        <div class="layui-card-body  " style="margin-top: 2px;background-color: white; padding: 2px">
            <table class=layui-table" lay-skin="line" style="font-size: 14px">
                <tr>
                    <td>异常确定时间：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityAbnormalTime' readonly/></td>
                    <td>异常类型：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityAbnormalType' readonly/></td>
                    <td>异常信息：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityAbnormalMessage' readonly/></td>
                </tr>
                <tr>
                    <td>异常说明：</td>
                    <td><input style='border: 0px;' id='duplicateIdentityAbnormalExplain' readonly/></td>
                </tr>
            </table>
        </div>


        <div style="width: 100% ; height: 180px;background-color: white;margin-top: 1px;">
            <div class="layui-form-item">
                <div class="layui-tab" style="margin:0px ">
                    <ul class="layui-tab-title">
                        <li class="layui-this" id="clickAbnormalTrack">异常轨迹
                        </li>
<!--                        <li class="" id="clickCurrentTrack">当前轨迹-->
<!--                        </li>-->
                    </ul>
                    <div class="layui-tab-content" style="padding: 0px;" >
                        <div id='abnormalTrack' class="layui-tab-item layui-show" style=";overflow-y: auto;height: 130px;">
                            <from action="" class="layui-form send-form" >
                                <table class="layui-table" id="abnormalTrack-table"
                                       lay-filter="abnormalTrack-table"
                                       style="overflow-y: auto;margin: 0px;"></table>
                            </from>
                        </div>
                        <div id='currentTrack' class="layui-tab-item layui-show">
                            <from action="" class="layui-form send-form">
                                <table class="layui-table" id="currentTrack-table"
                                       lay-filter="currentTrack-table"
                                       style="overflow-y: auto;margin: 0px;"></table>
                            </from>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div style="width: 100% ; height: 350px;background-color: white;" id="map">
            <iframe src="pages/vdl/vdlMap.html" width="100%" height="100%">
            </iframe>
        </div>

        <div style="width: 100% ; height: 30px;background-color: white;padding: 1px">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 1px">异常处理：</p>
        </div>
        <div class="layui-card-body  " style="margin-top: 2px;background-color: white; height: 150px;padding: 0px ">
            <label class="layui-form-label" style="padding: 0px">处理结果：</label>
            <div class="layui-input-block" style="margin-top: 7px;padding: 0px">
                <input type="radio" name="dealResult" value="MISJUDGED" title="误判" lay-filter="dealResult"
                       checked/><span>误判</span>
                <input type="radio" name="dealResult" value="RECTIFIED" title="已整改"
                       lay-filter="dealResult"/><span>已整改</span>
                <input type="radio" name="dealResult" value="SPECIAL" title="其他特殊情况"
                       lay-filter="dealResult"/><span>其他特殊情况</span>
            </div>
            <div class="layui-form-item" style="margin-top: 10px;min-height: 0px;padding: 0px;margin: 0px">
                <label class="layui-form-label" style="padding: 0px">情况说明：</label>
                <div class="layui-input-block" style="padding: 0px;">
                    <input name="title" id="description" class="layui-input layui-form-danger" required="" type="text"
                           placeholder="请输入情况说明" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div style=" margin-top: 10px; margin-left: 50px;">
                <button class="layui-btn layui-btn-normal" style="float: left;"
                        lay-filter="dealDuplicateIdentity-submit" lay-submit>保存
                </button>
                <!--                <a class="layui-btn layui-btn-normal " onclick="window.location.href='\#!aisDynamicInformation'"-->
                <!--                   style="margin-left: 20px;" id="return" lay-event="return">-->
                <!--                    返回-->
                <!--                </a>-->

                <a class="layui-btn layui-btn-normal "
                   style="margin-left: 20px;" id="return" lay-event="return">
                    返回
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['form', 'table', 'util', 'common', 'admin', 'laydate', 'jquery', 'layer', 'table', 'layedit', 'upload', 'element', 'carousel'], function () {
        var form = layui.form;
        var table = layui.table;
        var config = layui.common;
        var layer = layui.layer;
        var admin = layui.admin;
        var $ = layui.jquery;
        carousel = layui.carousel;
        var table = layui.table;
        let duplicateIdentityDetail = admin.getTempData('duplicateIdentity');
        $('#duplicateIdentityShipMmsi').val(duplicateIdentityDetail.mmsi);
        $('#duplicateIdentityAbnormalType').val(duplicateIdentityDetail.resultType);
        $('#duplicateIdentityAbnormalTime').val(layui.util.toDateString(duplicateIdentityDetail.receiveTime, "yyyy-MM-dd HH:mm:ss"));
        $('#duplicateIdentityID').val(duplicateIdentityDetail.id);
        $('#duplicateIdentityAbnormalExplain').val(duplicateIdentityDetail.errorContent);

        $("#return").click(function () {
            admin.closePopupCenter();
        })

        abnormalTrack();
        // drawAbnormalTrack();
        $("#clickAbnormalTrack").click(function () {
            abnormalTrack();
            // drawAbnormalTrack();
        })
        // $("#clickCurrentTrack").click(function () {
            // currentTrack();
        // })

        function abnormalTrack() {
            table.render({
                elem: '#abnormalTrack-table',
                url: config.base_server + 'aisDuplicateIdentity/findPageDetailNormal?mmsi=' + duplicateIdentityDetail.mmsi,
                method: 'GET',
                headers: {'Authorization': 'Bearer ' + config.getToken().access_token},
                page: false,
                cols: [[
                    {
                        field: 'receiveTime', title: '接收时间', sort: true, templet: function (d) {
                            return layui.util.toDateString(d.receiveTime);
                        }
                    },
                    {
                        field: 'sog', title: '航速', templet: function (d) {
                            return (d.sog) / 10;
                        }
                    },
                    {field: 'msgId', title: '报文类型',},
                    {field: 'wakeId', title: '航迹', sort: true},
                    {
                        field: 'lng', title: '经度', templet: function (d) {
                            return (d.lng / 600000).toFixed(5);
                        }
                    },
                    {
                        field: 'lat', title: '纬度', templet: function (d) {
                            return (d.lat / 600000).toFixed(5);
                        }
                    },
                ]]
            });
        }

        // function currentTrack() {
        //     table.render({
        //         elem: '#currentTrack-table',
        //         url: config.base_server + 'aisDuplicateIdentity/findPageDetailAbnormal?mmsi=' + duplicateIdentityDetail.mmsi,
        //         method: 'GET',
        //         headers: {'Authorization': 'Bearer ' + config.getToken().access_token},
        //         page: false,
        //         cols: [[
        //             {
        //                 field: 'time', title: '接收时间', sort: true, templet: function (d) {
        //                     return layui.util.toDateString(d.time);
        //                 }
        //             },
        //             {field: 'sog', title: '航速'},
        //             {field: 'msgId', title: '报文类型',},
        //             {field: 'trackId', title: '航迹', sort: true},
        //             {field: 'lng', title: '经度'},
        //             {field: 'lat', title: '纬度'},
        //         ]],
        //     });
        // }

        // 历史轨迹数据
        var trackplaybackdata = [];
        drawAbnormalTrack();
        function drawAbnormalTrack() {
            var data = {
                parentId: $('#duplicateIdentityID').val(),
            }
            admin.req('aisDuplicateIdentity/getErrorTrackInfo', JSON.stringify(data), function (data) {
                trackplaybackdata.push(data);
            }, "POST");
        }

        form.on('submit(dealDuplicateIdentity-submit)', function () {
            var data = {
                id: $('#duplicateIdentityID').val(),
                errorStatus: $("input[name='dealResult']:checked").val(),
                errorContent: $('#description').val(),
            }
            admin.req('aisDuplicateIdentity/duplicateIdentity/saveDeal', JSON.stringify(data), function (data) {
                if (data.resp_code === 0) {
                    layer.msg(data.resp_msg, {icon: 1, time: config.msgTime});
                    $('#duplicateIdentityAbnormalExplain').val($('#description').val());
                } else {
                    layer.msg(data.resp_msg, {icon: 2, time: config.msgTime});
                }
                table.reload('aisDuplicateIdentity-table');
            }, "POST");
        });

    });
</script>
</html>
