
<div class="layui-card" >
    <div class="layui-card-header" >
        <h2 class="header-title" >AIS信号丢失真实性辨识结果</h2>
    </div>

    <div style=" margin-top: 20px ;margin-left: 10px;">

        <div style="width: 100% ; height: 30px;background-color: white;">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 10px">船舶基本信息：</p>
        </div>

        <div class="layui-card-body  " style="margin-top: 20px;background-color: white; ">
            <table class=layui-table" lay-skin="line" style="font-size: 14px">
                <tr>
                    <td >MMSI：</td>
                    <td><input style='border: 0px;' id='shipMmsi' readonly /></td>
                    <td ><font color="blue">当前位置：</font></td>
                    <td><input style='border: 0px; ' id='###' readonly /><p style="color:blue;">(经度)</p></td>
                    <td><input style='border: 0px; ' id='###' readonly /><p style="color:blue;">(纬度)</p></td>
                </tr>
            </table>
           <!-- <div  style=" width: 120px;"> <label style="font-size: small" > <p style="background-color: #9F9F9F;">船舶登记查询数据库 </p></label></div >
            <table class=layui-table" lay-skin="line" >
                <tr>
                    <td style="font-size: small; white-space:nowrap;   width: auto;   ">船舶辨识号：</td>
                    <td><input style='border: 0px;white-space:nowrap;   width: auto;   font-size: small ' id='###' readonly /></td>
                    <td style="font-size: small;white-space:nowrap;   width: auto;   ">船名（中文）：</td>
                    <td><input style='border: 0px;white-space:nowrap;   width: auto;   font-size: small' id='shipMmsi' readonly /></td>
                    <td style="font-size: small;white-space:nowrap;   width: auto;   ">船名（英文）：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small;' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船舶类型：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">呼号：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                <tr>
                </tr>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">总长：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">型宽：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">型深：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">IMO：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">IMO（劳氏）：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">最后更新时间：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                </tr>
            </table>
            <div style="width: 120px;"> <label ><p style="background-color: #9F9F9F;"> 船舶无线电 数据库 </p></label></div>
            <table class=layui-table" lay-skin="line" >
                <tr>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船舶辨识号：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='###' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船名（中文）：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船名（英文）：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">AIS设备型号：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">呼号：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;  width: auto;   font-size: small">总长：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                </tr>
                <tr>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">总吨：</td>
                    <td><input style='white-space:nowrap; width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">号码类型：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船舶种类名：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap; width: auto;   font-size: small">航线代码：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;  width: auto;   font-size: small">航行区域：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;   width: auto;   font-size: small">船籍港名称：</td>
                    <td><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                    <td  style="white-space:nowrap;  width: auto;   font-size: small">审批日期：</td>
                    <td ><input style='white-space:nowrap;   width: auto;   border: 0px;font-size: small' id='shipMmsi' readonly /></td>
                </tr>
            </table>-->
        </div>


        <div style="width: 100% ; height: 30px;background-color: white;margin-top: 20px;">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 10px">船舶异常信息：</p>
        </div>

        <div class="layui-card-body ">
            <table  class=layui-table-box" lay-skin="line" style="font-size: 14px">
                <tr>
                    <td >异常确定时间：</td>
                    <td><input style='border: 0px;' id='receiveTime' readonly /></td>
                    <td >异常类型：</td>
                    <td><input style='border: 0px;' id='resultType' readonly /></td>
                    <td >异常信息：</td>
                    <td><input style='border: 0px;' id='resultInfo' readonly /></td>
                    <td >异常说明：</td>
                    <td><input style='border: 0px; width: auto;' id='resultInfoNote' readonly /></td>
                </tr>
            </table>

        </div>

        <div class="layui-card-body ">
            <table class="layui-table" lay-even lay-skin="nob" id="abnormalTarget-table" lay-filter="abnormalTarget-table"></table>
        </div>

        <script type="text/html" id="expandAll">
                <div class="detailView">
                    <div class="detailTitle">报文类型：{{d.msgContent.messageId}}转发指示符：{{d.msgContent.data.aisMessage.repeat}}MMSI：{{d.msgContent.shoreMmsi}} 导航状态：{{d.msgContent.data.aisMessage.navStatus}}转向率ROTAIS：{{d.msgContent.data.aisMessage.rot}}</div>
                    <div class="detailAuthor">位置准确度：{{d.msgContent.data.aisMessage.posAcc}} 经度： 纬度： SOG：{{d.msgContent.data.aisMessage.sog}} COG：{{d.msgContent.data.aisMessage.cog}}</div>
                    <div class="detailContent">实际航向：{{d.msgContent.data.aisMessage.trueHeading}} 时戳:{{d.msgContent.data.aisMessage.utcSec}} RAIM标志： {{d.msgContent.data.aisMessage.raim}}待定操纵指示符：{{d.msgContent.data.aisMessage.specialManIndicator}} </div>
                    <div class="detailAuthor">通信状态（同步状态）：{{d.msgContent.data.aisMessage.syncState}} 通信状态（时隙超时）：{{d.msgContent.data.aisMessage.slotTimeout}} 通信状态（子消息）： {{d.msgContent.data.aisMessage.subMessage}}</div>
                    <div class="detailAuthor">原始报文 </div>
                    <div class="detailAuthor">唯一标识： 顺序消息标识： 信号强度： 信噪比： UTC时间： 时隙号 </div>
                </div>
        </script>

        <div style="width: 100% ; height: 30px;background-color: white;margin-top:10px ; ">
            <p style="font-weight: bold; font-size: 20px ;background-color: white;padding: 10px">异常处理：</p>
        </div>

        <div class="layui-card-body  " style="margin-top: 2px;background-color: white; height: 150px;padding: 0px ">
            <label class="layui-form-label" style="padding: 0px">处理结果：</label>
            <div class="layui-input-block" style="margin-top: 7px;padding: 0px">
                <input type="radio" name="dealResult" value="MISJUDGED" title="误判" lay-filter="dealResult"
                       checked/><span>误判</span>
                <input type="radio" name="dealResult" value="RECTIFIED" title="已整改"
                       lay-filter="dealResult"/><span>已整改</span>
                <input type="radio" name="dealResult" value="SPECIAL" title="其他特殊情况"
                       lay-filter="dealResult"/><span>其他特殊情况</span>
            </div>
            <div class="layui-form-item" style="margin-top: 10px;min-height: 0px;padding: 0px;margin: 0px">
                <label class="layui-form-label" style="padding: 0px">情况说明：</label>
                <div class="layui-input-block" style="padding: 0px;">
                    <input name="title" id="description" class="layui-input layui-form-danger" required="" type="text"
                           placeholder="请输入情况说明" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div style=" margin-top: 10px; margin-left: 50px;">
                <button class="layui-btn layui-btn-normal" style="float: left;"
                        lay-filter="dealDuplicateIdentity-submit" lay-submit>保存
                </button>

                <a class="layui-btn layui-btn-normal "
                   style="margin-left: 20px;" id="return" lay-event="return">
                    返回
                </a>
            </div>
        </div>

        </div>
    </div>

<link rel="stylesheet" href="https://unpkg.com/layui-soul-table/docs/soulTable.css" media="all"/>


<script>

    // 自定义模块，这里只需要开放soulTable即可
    layui.config({
        base: 'module/',   // 第三方模块所在目录
        version: 'v1.6.4' // 插件版本号
    }).extend({
        soulTable: 'soulTable/soulTable',
        tableChild: 'soulTable/tableChild',
        tableMerge: 'soulTable/tableMerge',
        tableFilter: 'soulTable/tableFilter',
        excel: 'soulTable/excel',
    });

    layui.use(['form', 'table', 'util','soulTable', 'common', 'admin','laydate','jquery', 'layer', 'table','layedit','upload', 'element', 'carousel'], function () {
        var form = layui.form;
        var table = layui.table;
        var config = layui.common;
        var layer = layui.layer;
        var util = layui.util;
        var admin = layui.admin;
        var laydate = layui.laydate;

        var $ = layui.jquery;
        var element = layui.element;
        carousel = layui.carousel;
        // echarts = layui.echarts;
        var table = layui.table;
        var layedit = layui.layedit;
        var upload = layui.upload;
        var soulTable = layui.soulTable;
        // var dtree = layui.dtree;
        // 回显menu数据
        var mmsi = admin.getTempData('mmsi');
        if(mmsi == undefined){
            mmsi = 0
        }
        var resultInfo = admin.getTempData('resultInfo');
        var id = admin.getTempData('id');


        // 渲染表格
        table.render({

            elem: '#abnormalTarget-table',
            url: config.base_server + 'lossOfAisSignal-api/lostInfo/checkEntity',
            method: 'GET',
            headers: {'Authorization': 'Bearer ' + config.getToken().access_token},
            page: true,
            where:{mmsi:mmsi,resultInfo:resultInfo},
            parseData : function(data) {

                    $("#receiveTime").val(data.receiveTime)
                    $("#resultInfo").val(data.resultInfo)
                    $("#resultInfoNote").val(data.resultInfoNote)
                    $("#resultType").val(data.resultType)


                if (data.nauShipDto != null){

                    $("#shipMMSI").val(data.nauShipDto.mmsi)
                    $("#shipName").val(data.nauShipDto.nameEn)
                    $("#shipType").val(data.nauShipDto.shipTypeCode)
                    $("#shipCall").val(data.nauShipDto.callSign)
                    $("#shipImo").val(data.nauShipDto.imo)
                    $("#shipAisType").val(data.nauShipDto.aisType)
                    $("#shipLength").val(data.nauShipDto.lengthh)
                    $("#shipWidth").val(data.nauShipDto.width)
                }

                return {
                    "code" : data.code,
                    "msg" : data.msg,
                    "count": data.total,
                    "data" : data.errorLostMsg

                }

            },
            cols: [[

                {
                    field: 'receiveTime', title: '接收时间', collapse: true, children: '#expandAll', childWidth: 'full',templet: function (e) {
                        return  layui.util.toDateString(e.receiveTime, "yyyy-MM-dd HH:mm:ss");

                    }
                },
                {field: 'msgId', title: '报文类型', templet: function (e) {
                        return e.msgId + '号';
                    }},
                {field: 'mmsi', title: 'MMSI'},
                {field: 'errorCount', title: '船舶坐标'},


            ]]
            ,done: function () {
            soulTable.render(this)
        }

        });

        form.on('submit(dealDuplicateIdentity-submit)', function () {
            var data = {
                id: id,
                errorStatus: $("input[name='dealResult']:checked").val(),
                errorContent: $('#description').val(),
            }
            admin.req('lossOfAisSignal-api/lostInfo/saveDeal', JSON.stringify(data), function (data) {
                if (data.resp_code === 0) {
                    layer.msg(data.resp_msg, {icon: 1, time: config.msgTime});
                    $('#duplicateIdentityAbnormalExplain').val($('#description').val());
                } else {
                    layer.msg(data.resp_msg, {icon: 2, time: config.msgTime});
                }
                table.reload('abnormalTarget-table');
            }, "POST");
        });

    });

</script>